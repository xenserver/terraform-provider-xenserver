---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "xenserver_snapshot Resource - xenserver"
subcategory: ""
description: |-
  Provides a VM snapshot resource.
---

# xenserver_snapshot (Resource)

Provides a VM snapshot resource.

## Example Usage

```terraform
# snapshot from an exist running VM 
data "xenserver_vm" "vm_data" {
  name_label = "Test VM"
}

resource "xenserver_snapshot" "snapshot" {
  name_label  = "A test snapshot 1"
  vm_uuid     = data.xenserver_vm.vm_data.data_items[0].uuid
  with_memory = true
}

# snapshot from a new VM create by terraform
data "xenserver_sr" "sr" {
  name_label = "Local storage"
}

resource "xenserver_vdi" "vdi1" {
  name_label   = "local-storage-vdi-1"
  sr_uuid      = data.xenserver_sr.sr.data_items[0].uuid
  virtual_size = 100 * 1024 * 1024 * 1024
}

data "xenserver_network" "network" {}

resource "xenserver_vm" "vm" {
  name_label       = "A test virtual-machine"
  template_name    = "Windows 11"
  static_mem_max   = 4 * 1024 * 1024 * 1024
  vcpus            = 4
  cores_per_socket = 2
  cdrom            = "win11-x64_uefi.iso"

  hard_drive = [
    {
      vdi_uuid = xenserver_vdi.vdi1.uuid,
      bootable = true,
      mode     = "RW"
    },
  ]

  network_interface = [
    {
      network_uuid = data.xenserver_network.network.data_items[0].uuid,
      device       = "0"
    },
  ]
}

resource "xenserver_snapshot" "snapshot" {
  name_label = "A test snapshot 2"
  vm_uuid    = xenserver_vm.vm.uuid
}

# revert snapshot to VM, the VM resource 'hard_drive' will updated after revert, follow the document to update the terraform state before continue.
resource "xenserver_snapshot" "snapshot" {
  name_label = "A test snapshot 2"
  vm_uuid    = xenserver_vm.vm.uuid
  revert     = true
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `name_label` (String) The name of the snapshot.
- `vm_uuid` (String) Snapshot from the VM with the given UUID.

-> **Note:** `vm_uuid` is not allowed to be updated.

### Optional

- `revert` (Boolean) Set to `true` if you want to revert this snapshot to VM, default to be `false`.

-> **Note:** `revert` only works after the snapshot resource created. When `revert` is true, the snapshot resource attributes will be updated first, for example `name_label`. And then revert to VM.

~> **Warning:** After revert, the VM `hard_drive` will be updated. If snapshot revert to the VM resource defined in 'main.tf', it'll cause issue when continue execute terraform commands. There's a suggest solution to resolve this issue, follow the steps: <br>1. run `terraform state show xenserver_snapshot.<snapshot_resource_name>`, get the revert VM's UUID 'vm_uuid' and revert VDIs' UUID 'vdi_uuid'.<br>2. run `terraform state rm xenserver_vm.<vm_resource_name>` to remove the VM resource state.<br>3. run `terraform import xenserver_vm.<vm_resource_name> <vm_uuid>` to import the VM resource new state.<br>4. run `terraform state rm xenserver_vdi.<vdi_resource_name>` to remove the VDI resource state. Be careful, you only need to remove the VDI resource used in above VM resource. If there're multiple VDI resources, remove them all.<br>5. run `terraform import xenserver_vdi.<vdi_resource_name> <vdi_uuid>` to import the VDI resource new state. If there're multiple VDI resources, import them all.<br>
- `with_memory` (Boolean) True if snapshot with the VM's memory, default to be `false`.

-> **Note:** 1. `with_memory` field is not allowed to be updated.<br>2. the VM must be in a running state and have the [XenServer VM Tool](https://www.xenserver.com/downloads) installed.<br>

### Read-Only

- `id` (String) The test ID of the snapshot.
- `revert_vdis` (Attributes Set) The new VDIs created for VM after revert. Used for resume terraform state after revert. (see [below for nested schema](#nestedatt--revert_vdis))
- `uuid` (String) The UUID of the snapshot.

<a id="nestedatt--revert_vdis"></a>
### Nested Schema for `revert_vdis`

Required:

- `name_label` (String) The name of the virtual disk image.
- `sr_uuid` (String) The UUID of the storage repository used.

-> **Note:** `sr_uuid` is not allowed to be updated.

Optional:

- `name_description` (String) The description of the virtual disk image, default to be `""`.
- `other_config` (Map of String) The additional configuration of the virtual disk image, default to be `{}`.
- `raw_vdi_path` (String) The file path to the raw disk image (VDI), compatible with "Raw", "Tar", "VHD" formats.

-> **Note:**

 1. `raw_vdi_path` is required if `virtual_size` is not set. 2. `raw_vdi_path` is not allowed to be updated. 3. If `raw_vdi_path` is set, `virtual_size` will be ignored. 4. If `raw_vdi_path` is set, `type` will be `user`, `sharable` and `read_only` will be `false`.
- `read_only` (Boolean) True if this SR is (capable of being) shared between multiple hosts, default to be `false`.

-> **Note:** `read_only` is not allowed to be updated.
- `sharable` (Boolean) True if this disk may be shared, default to be `false`.

-> **Note:** `sharable` is not allowed to be updated.
- `type` (String) The type of the virtual disk image, default to be `"user"`.

-> **Note:** `type` is not allowed to be updated.
- `virtual_size` (Number) The size of virtual disk image (in bytes).

-> **Note:**

 1. `virtual_size` is required if `raw_vdi_path` is not set. 2. `virtual_size` is not allowed to be updated.

Read-Only:

- `id` (String) The test ID of the virtual disk image.
- `uuid` (String) The UUID of the virtual disk image.

## Import

Import is supported using the following syntax:

```shell
terraform import xenserver_snapshot.snapshot 00000000-0000-0000-0000-000000000000
```
